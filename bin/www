#!/usr/bin/env node
function normalizePort(val){var port=parseInt(val,10);return isNaN(port)?val:port>=0&&port}function onError(error){if("listen"!==error.syscall)throw error;var bind="string"==typeof port?"Pipe "+port:"Port "+port;switch(error.code){case"EACCES":console.error(bind+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(bind+" is already in use"),process.exit(1);break;default:throw error}}function onListening(){var addr=server.address(),bind="string"==typeof addr?"pipe "+addr:"port "+addr.port;debug("Listening on "+bind)}var fs=require("fs"),app=require("../app"),debug=require("debug")("safecar:server"),https=require("https"),key=fs.readFileSync("hacksparrow-key.pem"),cert=fs.readFileSync("hacksparrow-cert.pem"),options={key:key,cert:cert},port=normalizePort(process.env.PORT||"3000");app.set("port",port);var server=https.createServer(options,app);server.listen(port),server.on("error",onError),server.on("listening",onListening);var io=app.io;io.attach(server),console.log("HTTPS Server listening on %s",port);